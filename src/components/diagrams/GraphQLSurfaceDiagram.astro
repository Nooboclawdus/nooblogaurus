---
// Diagramme: Surface d'attaque GraphQL IDOR
// Queries, Mutations, Aliases, Batching
---

<div class="diagram-container">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 450" class="graphql-diagram">
    <defs>
      <filter id="glow-pink" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#ec4899" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <filter id="glow-cyan-gql" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#06b6d4" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <filter id="glow-violet" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#8b5cf6" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <filter id="glow-amber-gql" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#f59e0b" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      
      <pattern id="grid-gql" width="25" height="25" patternUnits="userSpaceOnUse">
        <path d="M 25 0 L 0 0 0 25" fill="none" stroke="rgba(100,100,140,0.06)" stroke-width="0.5"/>
      </pattern>
    </defs>
    
    <!-- Background -->
    <rect width="800" height="450" fill="#0c0c14" rx="8"/>
    <rect width="800" height="450" fill="url(#grid-gql)" rx="8"/>
    
    <!-- Title -->
    <text x="400" y="30" text-anchor="middle" fill="#e2e8f0" font-size="14" font-weight="600">Surface d'Attaque IDOR en GraphQL</text>
    
    <!-- Central GraphQL endpoint -->
    <g transform="translate(400, 80)">
      <rect x="-120" y="0" width="240" height="50" rx="6" fill="#0f1520" stroke="#ec4899" stroke-width="2" filter="url(#glow-pink)"/>
      <text x="0" y="22" text-anchor="middle" fill="#ec4899" font-size="12" font-weight="700">/graphql</text>
      <text x="0" y="40" text-anchor="middle" fill="#f9a8d4" font-size="9">Single endpoint, multiple vectors</text>
    </g>
    
    <!-- Connection lines -->
    <line x1="280" y1="130" x2="150" y2="170" stroke="#475569" stroke-width="1.5"/>
    <line x1="400" y1="130" x2="400" y2="170" stroke="#475569" stroke-width="1.5"/>
    <line x1="520" y1="130" x2="650" y2="170" stroke="#475569" stroke-width="1.5"/>
    
    <!-- ═══════════════════════════════════════════ -->
    <!-- QUERIES                                    -->
    <!-- ═══════════════════════════════════════════ -->
    <g transform="translate(150, 180)">
      <rect x="-120" y="0" width="240" height="130" rx="6" fill="#0f1520" stroke="#06b6d4" stroke-width="2" filter="url(#glow-cyan-gql)"/>
      <text x="0" y="22" text-anchor="middle" fill="#06b6d4" font-size="12" font-weight="700">Queries</text>
      <line x1="-100" y1="35" x2="100" y2="35" stroke="#164e63" stroke-width="1"/>
      
      <!-- Code example -->
      <g transform="translate(-105, 50)">
        <text fill="#67e8f9" font-size="9" style="font-family: monospace;">query </text>
        <text x="32" fill="#94a3b8" font-size="9" style="font-family: monospace;">getUser(id: </text>
        <text x="98" fill="#fca5a5" font-size="9" style="font-family: monospace;">"123"</text>
        <text x="125" fill="#94a3b8" font-size="9" style="font-family: monospace;">)</text>
      </g>
      
      <text x="-100" y="80" fill="#64748b" font-size="8">• user(id), order(id)</text>
      <text x="-100" y="95" fill="#64748b" font-size="8">• document(uuid)</text>
      <text x="-100" y="110" fill="#64748b" font-size="8">• Nested: user.privateData</text>
    </g>
    
    <!-- ═══════════════════════════════════════════ -->
    <!-- MUTATIONS                                  -->
    <!-- ═══════════════════════════════════════════ -->
    <g transform="translate(400, 180)">
      <rect x="-110" y="0" width="220" height="130" rx="6" fill="#0f1520" stroke="#8b5cf6" stroke-width="2" filter="url(#glow-violet)"/>
      <text x="0" y="22" text-anchor="middle" fill="#8b5cf6" font-size="12" font-weight="700">Mutations</text>
      <line x1="-90" y1="35" x2="90" y2="35" stroke="#4c1d95" stroke-width="1"/>
      
      <!-- Code example -->
      <g transform="translate(-95, 50)">
        <text fill="#a78bfa" font-size="9" style="font-family: monospace;">mutation </text>
        <text x="52" fill="#94a3b8" font-size="9" style="font-family: monospace;">updateUser(</text>
      </g>
      <g transform="translate(-95, 65)">
        <text fill="#94a3b8" font-size="9" style="font-family: monospace;">  id: </text>
        <text x="28" fill="#fca5a5" font-size="9" style="font-family: monospace;">"456"</text>
        <text x="58" fill="#94a3b8" font-size="9" style="font-family: monospace;">, data: ...)</text>
      </g>
      
      <text x="-90" y="95" fill="#64748b" font-size="8">• updateProfile(userId)</text>
      <text x="-90" y="110" fill="#64748b" font-size="8">• deleteResource(id)</text>
    </g>
    
    <!-- ═══════════════════════════════════════════ -->
    <!-- ALIASES                                    -->
    <!-- ═══════════════════════════════════════════ -->
    <g transform="translate(650, 180)">
      <rect x="-120" y="0" width="240" height="130" rx="6" fill="#0f1520" stroke="#f59e0b" stroke-width="2" filter="url(#glow-amber-gql)"/>
      <text x="0" y="22" text-anchor="middle" fill="#f59e0b" font-size="12" font-weight="700">Aliases / Batching</text>
      <line x1="-100" y1="35" x2="100" y2="35" stroke="#78350f" stroke-width="1"/>
      
      <!-- Code example -->
      <text x="-100" y="55" fill="#fbbf24" font-size="9" style="font-family: monospace;">u1: user(id: "1") ...</text>
      <text x="-100" y="70" fill="#fbbf24" font-size="9" style="font-family: monospace;">u2: user(id: "2") ...</text>
      <text x="-100" y="85" fill="#fbbf24" font-size="9" style="font-family: monospace;">u3: user(id: "3") ...</text>
      
      <text x="-100" y="105" fill="#ef4444" font-size="8" font-weight="600">→ Mass enumeration</text>
      <text x="-100" y="118" fill="#64748b" font-size="8">1 requête = N objets</text>
    </g>
    
    <!-- ═══════════════════════════════════════════ -->
    <!-- INTROSPECTION WARNING                      -->
    <!-- ═══════════════════════════════════════════ -->
    <g transform="translate(400, 340)">
      <rect x="-280" y="0" width="560" height="85" rx="6" fill="#1a0a0a" stroke="#dc2626" stroke-width="2"/>
      
      <text x="0" y="22" text-anchor="middle" fill="#ef4444" font-size="11" font-weight="700">⚠️ Introspection = Carte au trésor</text>
      
      <g transform="translate(-260, 40)">
        <text fill="#fca5a5" font-size="9" style="font-family: monospace;">__schema, __type</text>
        <text x="0" y="18" fill="#64748b" font-size="8">→ Liste tous les types, queries, mutations</text>
        <text x="0" y="33" fill="#64748b" font-size="8">→ Révèle les champs sensibles (adminOnly, internal...)</text>
      </g>
      
      <g transform="translate(120, 40)">
        <rect x="0" y="-5" width="140" height="50" rx="4" fill="#0f1520" stroke="#475569" stroke-width="1"/>
        <text x="70" y="12" text-anchor="middle" fill="#94a3b8" font-size="8">Outil recommandé:</text>
        <text x="70" y="28" text-anchor="middle" fill="#22c55e" font-size="10" font-weight="600">graphql-voyager</text>
        <text x="70" y="40" text-anchor="middle" fill="#64748b" font-size="7">Visualisation du schéma</text>
      </g>
    </g>
  </svg>
</div>

<style>
  .diagram-container {
    margin: 2rem 0;
    overflow-x: auto;
    padding: 0.5rem 0;
  }
  
  .graphql-diagram {
    width: 100%;
    min-width: 600px;
    max-width: 800px;
    margin: 0 auto;
    display: block;
  }
</style>
