---
// Diagramme: La mÃ©thode 2-comptes pour tester les IDOR
// Flow vertical: Setup â†’ Cartographie â†’ Test â†’ RÃ©sultat
---

<div class="diagram-container">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 700 520" class="idor-diagram">
    <defs>
      <filter id="glow-green" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#22c55e" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <filter id="glow-red" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#ef4444" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <filter id="glow-cyan" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#06b6d4" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      <filter id="glow-amber" x="-20%" y="-20%" width="140%" height="140%">
        <feGaussianBlur stdDeviation="3" result="blur"/>
        <feFlood flood-color="#f59e0b" flood-opacity="0.4"/>
        <feComposite in2="blur" operator="in"/>
        <feMerge><feMergeNode/><feMergeNode in="SourceGraphic"/></feMerge>
      </filter>
      
      <pattern id="grid-idor" width="25" height="25" patternUnits="userSpaceOnUse">
        <path d="M 25 0 L 0 0 0 25" fill="none" stroke="rgba(100,100,140,0.06)" stroke-width="0.5"/>
      </pattern>
      
      <marker id="arrow-down" viewBox="0 0 10 10" refX="5" refY="10" markerWidth="6" markerHeight="6" orient="auto">
        <path d="M 0 0 L 5 10 L 10 0" fill="none" stroke="#64748b" stroke-width="1.5"/>
      </marker>
    </defs>
    
    <!-- Background -->
    <rect width="700" height="520" fill="#0c0c14" rx="8"/>
    <rect width="700" height="520" fill="url(#grid-idor)" rx="8"/>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- STEP 1: SETUP                               -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <g transform="translate(350, 30)">
      <rect x="-160" y="0" width="320" height="55" rx="6" fill="#0f1520" stroke="#f59e0b" stroke-width="2" filter="url(#glow-amber)"/>
      <text x="-130" y="22" fill="#f59e0b" font-size="11" font-weight="700" style="font-family: monospace;">â‘ </text>
      <text x="-105" y="22" fill="#f59e0b" font-size="12" font-weight="600">SETUP</text>
      <text x="0" y="42" text-anchor="middle" fill="#94a3b8" font-size="10">CrÃ©er 2 comptes â€¢ SÃ©parer les navigateurs â€¢ Lancer le proxy</text>
    </g>
    
    <!-- Arrow 1â†’2 -->
    <line x1="350" y1="85" x2="350" y2="115" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-down)"/>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- STEP 2: CARTOGRAPHIE (Compte A)             -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <g transform="translate(350, 125)">
      <rect x="-160" y="0" width="320" height="85" rx="6" fill="#0f1520" stroke="#22c55e" stroke-width="2" filter="url(#glow-green)"/>
      <text x="-130" y="22" fill="#22c55e" font-size="11" font-weight="700" style="font-family: monospace;">â‘¡</text>
      <text x="-105" y="22" fill="#22c55e" font-size="12" font-weight="600">CARTOGRAPHIE</text>
      <text x="130" y="22" fill="#22c55e" font-size="10" style="font-family: monospace;">[Compte A]</text>
      <text x="0" y="45" text-anchor="middle" fill="#94a3b8" font-size="10">Naviguer dans l'app â€¢ Explorer toutes les fonctionnalitÃ©s</text>
      <text x="0" y="62" text-anchor="middle" fill="#94a3b8" font-size="10">Noter tous les IDs : user_id, doc_id, org_id...</text>
      <text x="0" y="76" text-anchor="middle" fill="#64748b" font-size="9" style="font-family: monospace;">â†’ Le proxy capture tout</text>
    </g>
    
    <!-- Arrow 2â†’3 -->
    <line x1="350" y1="210" x2="350" y2="240" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow-down)"/>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- STEP 3: TEST (Compte B)                     -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <g transform="translate(350, 250)">
      <rect x="-160" y="0" width="320" height="85" rx="6" fill="#0f1520" stroke="#ef4444" stroke-width="2" filter="url(#glow-red)"/>
      <text x="-130" y="22" fill="#ef4444" font-size="11" font-weight="700" style="font-family: monospace;">â‘¢</text>
      <text x="-105" y="22" fill="#ef4444" font-size="12" font-weight="600">TEST</text>
      <text x="130" y="22" fill="#ef4444" font-size="10" style="font-family: monospace;">[Compte B]</text>
      <text x="0" y="45" text-anchor="middle" fill="#94a3b8" font-size="10">Reprendre les requÃªtes capturÃ©es</text>
      <text x="0" y="62" text-anchor="middle" fill="#94a3b8" font-size="10">Remplacer le token par celui de B</text>
      <text x="0" y="76" text-anchor="middle" fill="#64748b" font-size="9" style="font-family: monospace;">â†’ Envoyer avec les IDs de A</text>
    </g>
    
    <!-- Arrow 3â†’4 (splits) -->
    <line x1="350" y1="335" x2="350" y2="365" stroke="#64748b" stroke-width="1.5"/>
    <line x1="350" y1="365" x2="200" y2="395" stroke="#64748b" stroke-width="1.5"/>
    <line x1="350" y1="365" x2="500" y2="395" stroke="#64748b" stroke-width="1.5"/>
    
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- STEP 4: RESULTS                             -->
    <!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
    <!-- IDOR Found -->
    <g transform="translate(175, 405)">
      <rect x="-120" y="0" width="240" height="70" rx="6" fill="#0f1520" stroke="#ef4444" stroke-width="2" filter="url(#glow-red)"/>
      <text x="0" y="25" text-anchor="middle" fill="#ef4444" font-size="11" font-weight="700" style="font-family: monospace;">200 OK + donnÃ©es de A</text>
      <text x="0" y="50" text-anchor="middle" fill="#fca5a5" font-size="14" font-weight="700">ðŸŽ¯ IDOR trouvÃ©e</text>
    </g>
    
    <!-- Protected -->
    <g transform="translate(525, 405)">
      <rect x="-120" y="0" width="240" height="70" rx="6" fill="#0f1520" stroke="#22c55e" stroke-width="2" filter="url(#glow-green)"/>
      <text x="0" y="25" text-anchor="middle" fill="#22c55e" font-size="11" font-weight="700" style="font-family: monospace;">403 Forbidden / 404</text>
      <text x="0" y="50" text-anchor="middle" fill="#86efac" font-size="14" font-weight="700">âœ“ Access control OK</text>
    </g>
    
    <!-- Result labels -->
    <text x="175" y="495" text-anchor="middle" fill="#64748b" font-size="9">â†’ Documenter et reporter</text>
    <text x="525" y="495" text-anchor="middle" fill="#64748b" font-size="9">â†’ Passer au suivant</text>
  </svg>
</div>

<style>
  .diagram-container {
    margin: 2rem 0;
    overflow-x: auto;
    padding: 0.5rem 0;
  }
  
  .idor-diagram {
    width: 100%;
    min-width: 500px;
    max-width: 700px;
    margin: 0 auto;
    display: block;
  }
</style>
