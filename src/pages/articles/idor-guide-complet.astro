---
import Layout from '../../layouts/Layout.astro';
import { marked } from 'marked';
import fs from 'fs';
import path from 'path';

const article = {
  title: "IDOR : Le guide pour ceux qui en ont marre des guides IDOR",
  description: "Comment j'ai arrêté de lire 'changez le 1 en 2' et commencé à trouver des trucs. La méthode qui marche, les erreurs qui te font perdre du temps, et du code réel.",
  date: "2026-02-07",
  tags: ["IDOR", "Bug Bounty", "Guide"],
  readingTime: "25 min"
};

const formattedDate = new Date(article.date).toLocaleDateString('fr-FR', {
  year: 'numeric',
  month: 'long',
  day: 'numeric'
});

// Read the markdown file
const contentPath = path.join(process.cwd(), 'src', 'content', 'articles', 'idor-guide-complet.md');
let mdContent = '';
try {
  mdContent = fs.readFileSync(contentPath, 'utf-8');
} catch {
  mdContent = `# ${article.title}\n\nContenu à venir...`;
}

const htmlContent = marked.parse(mdContent);
---

<Layout title={article.title} description={article.description}>
  <article class="py-8">
    <!-- Header -->
    <header class="mb-12">
      <div class="flex items-center gap-2 mb-4">
        {article.tags.map(tag => (
          <span class="text-xs font-mono px-2 py-1 rounded bg-[var(--color-bg-alt)] text-[var(--color-accent)]">
            {tag}
          </span>
        ))}
      </div>
      
      <div class="flex items-center gap-4 text-sm text-[var(--color-text-muted)] font-mono">
        <span>{formattedDate}</span>
        <span>•</span>
        <span>{article.readingTime} de lecture</span>
      </div>
    </header>
    
    <!-- Content -->
    <div class="prose-article" set:html={htmlContent} />
    
    <!-- Back link -->
    <div class="mt-12 pt-8 border-t border-[var(--color-border)]">
      <a href="/articles" class="text-[var(--color-text-muted)] hover:text-[var(--color-accent)] font-mono text-sm">
        ← Retour aux articles
      </a>
    </div>
  </article>
</Layout>

<style is:global>
  .prose-article {
    color: var(--color-text);
  }
  
  .prose-article h1 {
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 1rem;
    color: var(--color-text);
  }
  
  .prose-article h2 {
    font-size: 1.5rem;
    font-weight: 600;
    margin-top: 2.5rem;
    margin-bottom: 1rem;
    color: var(--color-text);
    border-bottom: 1px solid var(--color-border);
    padding-bottom: 0.5rem;
  }
  
  .prose-article h3 {
    font-size: 1.25rem;
    font-weight: 600;
    margin-top: 2rem;
    margin-bottom: 0.75rem;
    color: var(--color-text);
  }
  
  .prose-article h4 {
    font-size: 1.125rem;
    font-weight: 600;
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
    color: var(--color-text);
  }
  
  .prose-article p {
    margin-bottom: 1rem;
    color: var(--color-text-muted);
    line-height: 1.75;
  }
  
  .prose-article blockquote {
    border-left: 4px solid var(--color-accent);
    padding-left: 1rem;
    font-style: italic;
    color: var(--color-text-muted);
    margin: 1.5rem 0;
  }
  
  .prose-article ul, .prose-article ol {
    margin-bottom: 1rem;
    padding-left: 1.5rem;
  }
  
  .prose-article li {
    margin-bottom: 0.5rem;
    color: var(--color-text-muted);
    line-height: 1.75;
  }
  
  .prose-article code {
    background: var(--color-bg-alt);
    padding: 0.125rem 0.375rem;
    border-radius: 0.25rem;
    color: var(--color-accent);
    font-family: monospace;
    font-size: 0.875rem;
  }
  
  .prose-article pre {
    background: var(--color-bg-alt);
    padding: 1rem;
    border-radius: 0.5rem;
    overflow-x: auto;
    margin: 1.5rem 0;
    border: 1px solid var(--color-border);
  }
  
  .prose-article pre code {
    background: transparent;
    padding: 0;
    color: var(--color-text);
    font-size: 0.875rem;
    line-height: 1.5;
  }
  
  .prose-article table {
    width: 100%;
    margin: 1.5rem 0;
    border-collapse: collapse;
  }
  
  .prose-article th {
    text-align: left;
    padding: 0.75rem;
    border-bottom: 1px solid var(--color-border);
    color: var(--color-text);
    font-weight: 600;
    background: var(--color-bg-alt);
  }
  
  .prose-article td {
    padding: 0.75rem;
    border-bottom: 1px solid var(--color-border);
    color: var(--color-text-muted);
  }
  
  .prose-article a {
    color: var(--color-accent);
  }
  
  .prose-article a:hover {
    text-decoration: underline;
  }
  
  .prose-article hr {
    margin: 2.5rem 0;
    border-color: var(--color-border);
  }
  
  .prose-article strong {
    color: var(--color-text);
    font-weight: 600;
  }
  
  .prose-article em {
    font-style: italic;
  }
</style>
